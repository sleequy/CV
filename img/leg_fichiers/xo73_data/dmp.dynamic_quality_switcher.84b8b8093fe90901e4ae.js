(this.dmpJsonp=this.dmpJsonp||[]).push([["dynamic_quality_switcher"],{"6xEa":function(t,e,r){var s,i=function(){function t(t,e){if(!i[t]){i[t]={};for(var r=0;r<t.length;r++)i[t][t.charAt(r)]=r}return i[t][e]}var e=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},a={compressToBase64:function(t){if(null==t)return"";var e=a._compress(t,6,function(t){return r.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:a._decompress(e.length,32,function(s){return t(r,e.charAt(s))})},compressToUTF16:function(t){return null==t?"":a._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:a._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=a.compress(t),r=new Uint8Array(2*e.length),s=0,i=e.length;s<i;s++){var n=e.charCodeAt(s);r[2*s]=n>>>8,r[2*s+1]=n%256}return r},decompressFromUint8Array:function(t){if(null==t)return a.decompress(t);for(var r=new Array(t.length/2),s=0,i=r.length;s<i;s++)r[s]=256*t[2*s]+t[2*s+1];var n=[];return r.forEach(function(t){n.push(e(t))}),a.decompress(n.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":a._compress(t,6,function(t){return s.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),a._decompress(e.length,32,function(r){return t(s,e.charAt(r))}))},compress:function(t){return a._compress(t,16,function(t){return e(t)})},_compress:function(t,e,r){if(null==t)return"";var s,i,a={},n={},o="",h="",l="",u=2,d=3,c=2,f=[],v=0,g=0,p;for(p=0;p<t.length;p+=1)if(o=t.charAt(p),Object.prototype.hasOwnProperty.call(a,o)||(a[o]=d++,n[o]=!0),h=l+o,Object.prototype.hasOwnProperty.call(a,h))l=h;else{if(Object.prototype.hasOwnProperty.call(n,l)){if(l.charCodeAt(0)<256){for(s=0;s<c;s++)v<<=1,g==e-1?(g=0,f.push(r(v)),v=0):g++;for(i=l.charCodeAt(0),s=0;s<8;s++)v=v<<1|1&i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i>>=1}else{for(i=1,s=0;s<c;s++)v=v<<1|i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i=0;for(i=l.charCodeAt(0),s=0;s<16;s++)v=v<<1|1&i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i>>=1}u--,0==u&&(u=Math.pow(2,c),c++),delete n[l]}else for(i=a[l],s=0;s<c;s++)v=v<<1|1&i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i>>=1;u--,0==u&&(u=Math.pow(2,c),c++),a[h]=d++,l=String(o)}if(""!==l){if(Object.prototype.hasOwnProperty.call(n,l)){if(l.charCodeAt(0)<256){for(s=0;s<c;s++)v<<=1,g==e-1?(g=0,f.push(r(v)),v=0):g++;for(i=l.charCodeAt(0),s=0;s<8;s++)v=v<<1|1&i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i>>=1}else{for(i=1,s=0;s<c;s++)v=v<<1|i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i=0;for(i=l.charCodeAt(0),s=0;s<16;s++)v=v<<1|1&i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i>>=1}u--,0==u&&(u=Math.pow(2,c),c++),delete n[l]}else for(i=a[l],s=0;s<c;s++)v=v<<1|1&i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i>>=1;u--,0==u&&(u=Math.pow(2,c),c++)}for(i=2,s=0;s<c;s++)v=v<<1|1&i,g==e-1?(g=0,f.push(r(v)),v=0):g++,i>>=1;for(;;){if(v<<=1,g==e-1){f.push(r(v));break}g++}return f.join("")},decompress:function(t){return null==t?"":""==t?null:a._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(t,r,s){var i=[],a,n=4,o=4,h=3,l="",u=[],d,c,f,v,g,p,m,E={val:s(0),position:r,index:1};for(d=0;d<3;d+=1)i[d]=d;for(f=0,g=Math.pow(2,2),p=1;p!=g;)v=E.val&E.position,E.position>>=1,0==E.position&&(E.position=r,E.val=s(E.index++)),f|=(v>0?1:0)*p,p<<=1;switch(a=f){case 0:for(f=0,g=Math.pow(2,8),p=1;p!=g;)v=E.val&E.position,E.position>>=1,0==E.position&&(E.position=r,E.val=s(E.index++)),f|=(v>0?1:0)*p,p<<=1;m=e(f);break;case 1:for(f=0,g=Math.pow(2,16),p=1;p!=g;)v=E.val&E.position,E.position>>=1,0==E.position&&(E.position=r,E.val=s(E.index++)),f|=(v>0?1:0)*p,p<<=1;m=e(f);break;case 2:return""}for(i[3]=m,c=m,u.push(m);;){if(E.index>t)return"";for(f=0,g=Math.pow(2,h),p=1;p!=g;)v=E.val&E.position,E.position>>=1,0==E.position&&(E.position=r,E.val=s(E.index++)),f|=(v>0?1:0)*p,p<<=1;switch(m=f){case 0:for(f=0,g=Math.pow(2,8),p=1;p!=g;)v=E.val&E.position,E.position>>=1,0==E.position&&(E.position=r,E.val=s(E.index++)),f|=(v>0?1:0)*p,p<<=1;i[o++]=e(f),m=o-1,n--;break;case 1:for(f=0,g=Math.pow(2,16),p=1;p!=g;)v=E.val&E.position,E.position>>=1,0==E.position&&(E.position=r,E.val=s(E.index++)),f|=(v>0?1:0)*p,p<<=1;i[o++]=e(f),m=o-1,n--;break;case 2:return u.join("")}if(0==n&&(n=Math.pow(2,h),h++),i[m])l=i[m];else{if(m!==o)return null;l=c+c.charAt(0)}u.push(l),i[o++]=c+l.charAt(0),n--,c=l,0==n&&(n=Math.pow(2,h),h++)}}};return a}();s=function(){return i}.call(e,r,e,t),void 0===s||(t.exports=s)},DqVu:function(t,e,r){"use strict";function s(){this.attributes({resource:null,autoplay:!1,autoplayAllowed:!1,dependencies:null}),this.currentSource=null,this.decodeErrorCount=0,this.freezeErrorCount=0,this.decodeErrorDate=[null,null,null],this.pendingRecovery=!1,this._createHlsSource=function(t){null!==this.currentSource&&(this.currentSource.destroy(),this._unbindSourceEvents()),this.currentSource=b.createNew(this.videoTag,t,this.attr.dependencies.Hlsjs),this.currentSource.disableLevelCapping=c.a.isVR360Enabled(),this._bindSourceEvents()},this._bindSourceEvents=function(){this.currentSource.disableLevelCapping||(this.computeAutoLevelCapping=this.currentSource.computeAutoLevelCapping.bind(this.currentSource),this.on(a.a.PLAYER_SIZE_CHANGED,this.computeAutoLevelCapping),"function"==typeof window.matchMedia&&(this.mediaQuery=window.matchMedia("screen and (min-resolution: 2dppx)"),this.mediaQuery&&this.mediaQuery.addListener(this.computeAutoLevelCapping))),this.currentSource.on("level_state_change",this._onSourceLevelStateChange,this),this.currentSource.on("level_state_changed",this._onSourceLevelStateChanged,this),this.currentSource.on("fatal_error",this._onSourceFatalError,this)},this._unbindSourceEvents=function(){this.currentSource.disableLevelCapping||(this.off(a.a.PLAYER_SIZE_CHANGED,this.computeAutoLevelCapping),this.mediaQuery&&(this.mediaQuery.removeListener(this.computeAutoLevelCapping),this.mediaQuery=null),this.computeAutoLevelCapping=null),this.currentSource.off("level_state_change",this._onSourceLevelStateChange),this.currentSource.off("level_state_changed",this._onSourceLevelStateChanged),this.currentSource.off("fatal_error",this._onSourceFatalError,this)},this._onSourceLevelStateChange=function(t){var e={adaptive:t.adaptive,quality:this.qualityList.getQualityForLevel(t.levelIndex)};this.notifyQualityChangeConfirmed(e)},this._onSourceLevelStateChanged=function(t){var e=this.currentSource.getLiveEdgeDelay();e>0&&this.liveEdgeDelay!==e&&(this.liveEdgeDelay=e,this.trigger(a.a.LIVE_EDGE_DELAY_CHANGED,{delay:this.liveEdgeDelay}));var r={adaptive:t.adaptive,quality:this.qualityList.getQualityForLevel(t.levelIndex)};this.decodeErrorDate=[null,null,null],this.notifyQualityChanged(r)},this._onSourceFatalError=function(t){this.videoSlotStarted&&this._handleError(t.error,t.reason)},this.waitForQualityList=function(){var t=this.attr.resource||this.attr.qualities.auto.find(t=>{var e=t.type;return e===A.a.HLS});return new Promise((e,r)=>{if(null!=t)this._createHlsSource(t),this.currentSource.waitForManifest().then(t=>{var r=t.manifestData.levels,s=t.resource,i=_.a.createFromLevels(r,s);if(this.trigger(a.a.DEBUG_UPDATED,{type:"stream_origin",payload:{url:s.url,cell:this.currentSource.streamCell()}}),"videogames"===c.a.metadata("channel")&&"live"===c.a.metadata("stream_type")){var n=i.getHighestQuality();null!==n&&(n.tag="Source")}e(this.setQualityList(i))}).catch(t=>r(t));else{var s=new _.a;e(this.setQualityList(s))}})},this.getStats=function(t,e){if(!this.currentSource)return{};var r={decodeError:this.decodeErrorCount,freezeError:this.freezeErrorCount},s=this.currentSource.streamComment();if(s&&(r.comment=s),this.videoTag)if("function"==typeof this.videoTag.getVideoPlaybackQuality){var i=this.videoTag.getVideoPlaybackQuality();r.droppedVideoFrames=i.droppedVideoFrames,r.corruptedVideoFrames=i.corruptedVideoFrames}else{var n=this.videoTag.webkitDroppedFrameCount;n&&(r.droppedVideoFrames=n)}var o=this.currentSource.streamStats(e,this.qualityList);o&&(r.stream=o),this.trigger(a.a.QUALITY_STATS_RESPONDED,r)},this.changeQuality=function(t,e){var r=e.isStartup,s=e.isReplay,i=e.isRecovering,a=e.prefetch,n=null;n=i?"recover":s?"replay":r?"start":"current";var o=t.quality,h=this.qualityList.getLevelForQualityName(o.name),l={prefetch:a,heuristic:!1};r&&this.qualityChosenFromPlayerSize&&(l.heuristic=!0),this.pendingRecovery=i,this.currentSource.setLevel(h,t.adaptive,n,l).then(()=>{r&&!a&&this.videoTag&&this.videoTag.play()})},this.handleFirstSequenceStarted=function(){this.off(a.a.SEQUENCE_STARTED,this.handleFirstSequenceStarted),this.setup()},this.handleInitialQualitySet=function(t){this.changeQuality(t,{isStartup:!0,isReplay:!1,isRecovering:!1,prefetch:!0})},this.handleLoadedmetadataEvent=function(){if(this.trigger(a.a.VIDEO_LOADED_METADATA,{videoTagSelector:this.attr.videoTagSelector}),this.pendingRecovery){this.pendingRecovery=!1;var t={adaptive:this.currentSource.hls.autoLevelEnabled,quality:this.qualityList.getQualityForLevel(this.currentSource.hls.loadLevel)};this.notifyQualityChangeConfirmed(t,!0),this.notifyQualityChanged(t)}},this.handleErrorEvent=function(t){var e=t.target.error||{},r=null;switch(e.code){case e.MEDIA_ERR_ABORTED:r=i.e;break;case e.MEDIA_ERR_NETWORK:r=i.g;break;case e.MEDIA_ERR_DECODE:r=i.f;break;case e.MEDIA_ERR_SRC_NOT_SUPPORTED:r=i.h;break;default:r=i.l}this._handleError(r)},this._handleError=function(t,e){if(w.warn("error received:",t),t===i.f||"mediaErrorbufferAppendError"===t){var r=Date.now(),s=(this.decodeErrorCount+2)%3,a=this.decodeErrorDate[s];if(!a||r-a>3e3)return this.decodeErrorCount%2&&this.swapAudioCodec(),this.decodeErrorCount++,this.decodeErrorDate[s]=r,this.recoverDecodingError()}if("mediaErrorbufferStalledError"===t){var n=Date.now(),o=++this.freezeErrorCount,h=this.freezeErrorDate;if(this.freezeErrorDate=n,o<3&&(!h||n-h>1e4))return this.recoverDecodingError()}this.triggerQualitySwitcherError(t,e)},this.recoverDecodingError=function(){w.log("try to recover video decoding error"),this.currentSource.recoverDecodingError()},this.swapAudioCodec=function(){w.log("try to swap audio codec"),this.currentSource.swapAudioCodec()},this.streamCell=function(){return this.currentSource.streamCell()},this.streamTech=function(){return"hls.js"},this.after("initialize",function(){w.log("Initialized"),this.attr.autoplay&&this.attr.autoplayAllowed?this.handleFirstSequenceStarted():this.on(a.a.SEQUENCE_STARTED,this.handleFirstSequenceStarted),this.trigger(a.a.CAN_PLAY_ONE_SOURCE,{ok:!0}),this.on(a.a.VIDEO_ENDED,function(){this.currentSource.detachVideo()}),this.on(a.a.AD_LINEAR_WILL_START,function(t,e){var r=e.position;r!==M.a.MIDROLL&&r!==M.a.LIVEADBREAK||this.currentSource.detachVideo()}),this.on(a.a.CHROMECAST_REMOTE_ENABLED,function(){this.unbindMediaEvents(),this.currentSource.detachVideo()}),this.on(a.a.CHROMECAST_SESSION_STOPPED,function(){this.resetQualityState(),this.bindMediaEvents()}),this.on(a.a.LOAD_VIDEO,function(){this.teardown()})}),this.after("teardown",function(){w.log("Torn down"),this.currentSource&&(this._unbindSourceEvents(),this.currentSource.destroy(),this.currentSource=null)})}r.r(e);var i=r("XE2b"),a=r("znKg"),n=r("J4zp"),o=r.n(n),h=r("LwNu"),l=r("l/t8");class u{on(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("function"==typeof e)return this.listeners||(this.listeners={}),this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({func:e,scope:r}),this}off(t,e){if("function"!=typeof e)this.listeners[t]=[];else if(null!=this.listeners[t])for(var r=this.listeners[t].length-1;r>=0;r--){var s=this.listeners[t][r];s.func===e&&this.listeners[t].splice(r,1)}}trigger(t){if(this.listeners&&this.listeners[t]){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];for(var i=this.listeners[t].length-1;i>=0;i--){var a=this.listeners[t][i];if(!1===a.func.apply(a.scope,r))return}}}}var d=r("hHG0"),c=r("i/kS"),f=r("6xEa"),v=r.n(f),g=window.dmp_getLogger({Quality:"#ff4040:white",Hls:"pink"}),p="start",m="current",E="replay",L="recover",y=null;class S extends u{static createNew(t,e,r){return new S(t,e,r)}constructor(t,e,r){super(),y=r,this.hlsVersion=y.version||"stable",this.videoTag=t,this.resource=e,this.boundListeners=null,this.hls=null,this.manifestData=null,this.hashParams=null,this.mseAttached=!1,this.disableLevelCapping=!1,this.startLoad=!1,this.cumDownload=0,this.cumLatency=0,this.cumMux=0,this.cumBuffer=0,this.fragNb=0,this.fragDetailsNb=0,this.logArray=[],this.logMsg=null,this.resetStats(),this.logForwarder={log:function(t){this.appendMsg("log",t)}.bind(this),warn:function(t){this.appendMsg("warn",t)}.bind(this),error:function(t){this.appendMsg("error",t)}.bind(this),debug(t){g.log(t)},info(t){g.log(t)}},this.hlsConfig={abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,autoStartLoad:!1,debug:this.logForwarder,fragLoadingMaxRetry:5,fragLoadingTimeOut:2e4,highBufferWatchdogPeriod:4,levelLoadingMaxRetry:5,levelLoadingTimeOut:15e3,liveSyncDuration:24,manifestLoadingMaxRetry:5,manifestLoadingTimeOut:3e4,maxLoadingDelay:4,maxMaxBufferLength:30,maxStarvationDelay:4,maxSeekHole:4,nudgeMaxRetry:2,nudgeOffset:.3,startFragPrefetch:"recorded"===c.a.metadata("stream_type")}}appendMsg(t,e){if(e){if(!this.logMsg){var r=this.logArray,s=this.stats.maxLogs||100,i=performance.now(),a=this.t0=this.t0||i,n=Math.round(i-a);r.length>=s&&r.shift(),r.push("".concat(n,",").concat(t,": ").concat(e))}g[t](e)}}waitForManifest(){return new Promise((t,e)=>{if(this.hls||(g.log("create hls.js (".concat(this.hlsVersion,")")),this.hls=new y(this.hlsConfig),this.bindListeners()),this.manifestData)t(this);else{var r=(t,i)=>{i.fatal&&(g.error("catch fatal error at startup",i),this.hls.off(y.Events.ERROR,r),this.hls.off(y.Events.MANIFEST_PARSED,s),e(i))},s=(e,i)=>{d.H.saveEnd(d.q),g.log("succeed to parse manifest",i),this.hls.off(y.Events.ERROR,r),this.hls.off(y.Events.MANIFEST_PARSED,s),this.manifestData=i;var a=i.levels[i.firstLevel];this.parseHashParams(a.url[a.urlId]),t(this)};d.H.save(d.q),this.hls.on(y.Events.ERROR,r),this.hls.on(y.Events.MANIFEST_PARSED,s),this.hls.loadSource(this.resource.url)}})}attachVideo(){this.mseAttached||(g.log("Attach video to hls source"),this.hls.attachMedia(this.videoTag),this.mseAttached=!0,this.tvideo=performance.now())}setLevel(t,e,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=s.prefetch,a=void 0!==i&&i,n=s.heuristic,o=void 0!==n&&n;return a||this.attachVideo(),this.waitForManifest().then(()=>{var s=this.hls,i=!a,n=!1;r===p?(e?(o&&(t=-1),g.log("set hls.startLevel=".concat(t)),s.startLevel=t,this.stats.startLevel=t):(g.log("set hls.loadLevel=".concat(t)),s.loadLevel=t),this.startLoad||(d.H.save(d.r),g.log("call hls.startLoad()"),s.startLoad(),this.computeAutoLevelCapping(),this.startLoad=!0)):r===m?e?(g.log("set hls.nextLevel=".concat(-1)),s.nextLevel=-1,n=!0):s.autoLevelEnabled&&s.currentLevel===t||h.isIE()?(g.log("set hls.nextLevel=".concat(t)),s.nextLevel=t,n=!0):(g.log("set hls.currentLevel=".concat(t)),s.currentLevel=t):(s.startLoad(r===E?0:-1),i=!1),i&&this.notifyLevelStateChange(this.hls.autoLevelEnabled,t),n&&this.notifyLevelStateChanged(this.hls.autoLevelEnabled,t)})}getMaxLevelIndex(){var t=Math.max(160,this.videoTag.clientWidth)*Math.max(120,this.videoTag.clientHeight),e=window.devicePixelRatio;null!=e&&(t*=e*e);var r=this.hls.levels||[],s=r.length;if(0===s)return-1;for(var i=0;i<s;i++){var a=r[i],n=a.width*a.height;if(n>=.85*t)break}var o=Math.min(i,s-1);return o}notifyLevelStateChange(t,e){this.trigger("level_state_change",{adaptive:t,levelIndex:e})}notifyLevelStateChanged(t,e){this.trigger("level_state_changed",{adaptive:t,levelIndex:e})}computeAutoLevelCapping(){if(this.hls&&this.videoTag&&!this.disableLevelCapping){var t=this.getMaxLevelIndex(),e=this.hls.autoLevelCapping;t!==e&&(g.log("new capping index:".concat(t)),this.hls.autoLevelCapping=t,this.hls.autoLevelEnabled&&e>=0&&t>e&&(g.log("smooth switch up"),this.hls.nextLevel=-1))}}detachVideo(){g.log("Detach video from hls source");var t=this.hls;t&&null!==t.media&&t.detachMedia(),this.tvideo=void 0,this.mseAttached=!1}onHlsError(t,e){switch(e.details){case y.ErrorDetails.BUFFER_NUDGE_ON_STALL:var r=this.stats;r.nudgeNb=(r.nudgeNb||0)+1;break;case y.ErrorDetails.BUFFER_SEEK_OVER_HOLE:this.stats.maxBufferHole=this.stats.maxBufferHole>0?Math.max(this.stats.maxBufferHole,e.hole):e.hole;break;case y.ErrorDetails.INTERNAL_EXCEPTION:this.stats.exceptionNb++,this.stats.exception={event:e.event,stack:e.err.stack?JSON.stringify(e.err.stack).substr(0,1e3):e.err.message}}if(e.fatal){g.error("Received fatal HLS error:",t,e);var s=this.getHTTPStats(e);null!==s&&(this.stats.http=s),this.trigger("fatal_error",{error:e.type+e.details,reason:e.reason})}else g.warn("Received non-fatal HLS error:",t,e)}getHTTPStats(t){if(!t||!t.response)return null;var e={},r=t.response,s=t.frag||t.context;return r&&(e.code=parseInt(r.code||0),e.msg=(r.text||"").toLowerCase()),s&&(e.url=s.url||""),e}onLevelLoaded(t,e){d.H.hasSavedStart(d.r)&&d.H.saveEnd(d.r);var r=this.hls.config,s=this.hls.levels[e.level];s.details.live&&(this._liveEdgeDelay=r.liveSyncDuration>0?r.liveSyncDuration:r.liveSyncDurationCount*e.details.targetduration),s.urlId>0&&(this.stats.redundant=!0)}onCurrentFragmentChanged(t,e){this.notifyLevelStateChanged(this.hls.autoLevelEnabled,e.frag.level)}onFragBuffered(t,e){var r=this.stats,s=e.stats,i=s.tparsed,a=this.tvideo,n=a?Math.max(i,a):i,o=s.tload-s.trequest,h=s.tfirst-s.trequest,l=i-s.tload,u=s.tbuffered-n,d=o+l+u,c=r.minMs=r.minMs||{},f=r.maxMs=r.maxMs||{},v=this.cumDownload+=o,g=this.cumLatency+=h,p=this.cumMux+=l,m=this.cumBuffer+=u,E=v+p+m,L=++this.fragNb;r.HTTPDL+=s.loaded;var y=8*r.HTTPDL;this.appendFragDetails(e.frag,s),r.latency=Math.round(g/L),r.avgKbps={total:Math.round(y/E),dl:Math.round(y/v),mux:Math.round(y/p),buffer:Math.round(y/m)},r.avgMs={total:Math.round(E/L),dl:Math.round(v/L),mux:Math.round(p/L),buffer:Math.round(m/L)},d&&(c.total=Math.round(c.total?Math.min(c.total,d):d),f.total=Math.round(f.total?Math.max(f.total,d):d)),o&&(c.dl=Math.round(c.dl?Math.min(c.dl,o):o),f.dl=Math.round(f.dl?Math.max(f.dl,o):o)),l&&(c.mux=Math.round(c.mux?Math.min(c.mux,l):l),f.mux=Math.round(f.mux?Math.max(f.mux,l):l)),u&&(c.buffer=Math.round(c.buffer?Math.min(c.buffer,u):u),f.buffer=Math.round(f.buffer?Math.max(f.buffer,u):u))}onFragLoadEmergencyAborted(t,e){this.appendFragDetails(e.frag,e.stats),this.stats.emergencyNb++}appendFragDetails(t,e){if(this.fragDetailsNb<5){var r=this.videoTag,s=e.tparsed,i=this.tvideo,a=i?Math.max(s,i):s,n=e.tload-e.trequest,o=e.tfirst-e.trequest,h=e.loaded,l=s-e.tload,u=e.tbuffered-a,d=t.duration,c={start:Math.round(1e3*t.start),end:Math.round(1e3*(t.start+d)),l:t.level,pos:r?Math.round(1e3*r.currentTime):-1};o>0&&(c.lat=Math.round(o)),n>0&&(c.DLdur=Math.round(n)),h>0&&(c.len=h),h>0&&(c.kbps=Math.round(8*h/(n+l+u))),e.aborted&&(c.aborted=!0),l>0&&(c.mux=Math.round(l)),u>0&&(c.buffer=Math.round(u));var f=this.stats,v=f.frags=f.frags||{},g=v.minDuration;v.minDuration=g?Math.min(Math.round(d),g):Math.round(d),v["f".concat(this.fragDetailsNb)]=c,this.fragDetailsNb++}}recoverDecodingError(){var t=!this.videoTag.paused;g.log("playing state before recovery:",t);var e=()=>{this.hls.off(y.Events.MEDIA_ATTACHED,e),this.hls.startLoad(),t&&(g.log("video was playing before recovery, relaunch playback"),this.videoTag.play())};this.hls.recoverMediaError(),this.hls.on(y.Events.MEDIA_ATTACHED,e)}swapAudioCodec(){this.hls.swapAudioCodec()}bindListeners(){null==this.boundListeners&&(this.boundListeners={onCurrentFragmentChanged:this.onCurrentFragmentChanged.bind(this),onFragBuffered:this.onFragBuffered.bind(this),onFragLoadEmergencyAborted:this.onFragLoadEmergencyAborted.bind(this),onHlsError:this.onHlsError.bind(this),onLevelLoaded:this.onLevelLoaded.bind(this)},this.hls.on(y.Events.FRAG_CHANGED,this.boundListeners.onCurrentFragmentChanged),this.hls.on(y.Events.FRAG_BUFFERED,this.boundListeners.onFragBuffered),this.hls.on(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.boundListeners.onFragLoadEmergencyAborted),this.hls.on(y.Events.ERROR,this.boundListeners.onHlsError),this.hls.on(y.Events.LEVEL_LOADED,this.boundListeners.onLevelLoaded))}unbindListeners(){null!=this.boundListeners&&(this.hls.off(y.Events.FRAG_CHANGED,this.boundListeners.onCurrentFragmentChanged),this.hls.off(y.Events.FRAG_BUFFERED,this.boundListeners.onFragBuffered),this.hls.off(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.boundListeners.onFragLoadEmergencyAborted),this.hls.off(y.Events.ERROR,this.boundListeners.onHlsError),this.hls.off(y.Events.LEVEL_LOADED,this.boundListeners.onLevelLoaded),this.boundListeners=null)}streamCell(){return this.getHashParam("cell")}streamComment(){return this.getHashParam("comment")}getHashParam(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.hashParams;if(r){var s=null!==e&&r[e]?r[e]:r;return s[t]?s[t]:null}return null}parseHashParams(t){if(!this.hashParams){var e=Object(l.e)(t),r=e.hash,s=void 0===r?null:r;if(s){var i=this.hashParams={},a=this.onHashParamParsed.bind(this),n=Object(l.d)(s,!0);for(var h in n){var u=h.split("_"),d=o()(u,2),c=d[0],f=d[1],v=void 0===f?null:f;null===v?(i[h]=n[h],a(h,n[h])):(i[c]||(i[c]={}),i[c][v]=n[h],a(v,n[h],c))}g.log("Parsed hash-params:",i)}}}onHashParamParsed(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(r){case"hls":this.updateHLSConfigParam(t,e,!0);break;case"ab":case"qos":this.stats[t]=e}}updateHLSConfigParams(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)for(var r in t){var s=t[r];this.updateHLSConfigParam(r,s,e)}}updateHLSConfigParam(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"function"==typeof e?g.log("update hlsjs config param: ".concat(t,"=function(){}")):g.log("update hlsjs config param: ".concat(t,"=").concat(e));var s=this.hls?this.hls.config:this.hlsConfig;isNaN(e)||"boolean"==typeof e||(e=parseFloat(e)),s[t]=e,r&&(this.stats[t]=e)}streamStats(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,r=t.verbose||!1;if(r&&(this.logMsg||(this.logMsg=v.a.compressToBase64(this.logArray.join("\n")),this.logArray=[]),this.stats.logs=this.logMsg),e){var s=this.hls;if(s&&s.autoLevelCapping>-1){var i=e.getQualityForLevel(s.autoLevelCapping),a=null!==i?i.height:0;a>0&&(this.stats.autoLevelCapping=a)}}return this.stats}getLiveEdgeDelay(){return this._liveEdgeDelay||0}resetStats(){this.stats={version:this.hlsVersion,HTTPDL:0,emergencyNb:0,exceptionNb:0,latency:0}}destroy(){g.log("Destroy hls source"),this.resetStats(),this.detachVideo(),this.unbindListeners();var t=this.hls;t&&(t.destroy(),this.hls=null),y=null,this.hlsVersion=null,this.manifestData=null,this.hashParams=null,this.hlsConfig=null,this.startLoad=!1}}var b=S,A=r("z/W+"),_=r("Bau3"),C=r("0e73"),D=r("9HeL"),M=r("G1FZ"),w=window.dmp_getLogger({Quality:"#ff4040:white",DynamicQuality:"#cd3333:white"}),R=e.default=Object(C.a)(D.a,s)}}]);